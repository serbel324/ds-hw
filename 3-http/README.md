# HTTP Сервер

Необходимо реализовать простой HTTP сервер, выполняющий функции хранилища
файлов.

## Требуемый функционал

Сервер должен запускаться из командной строки со следующими параметрами:

| Параметр              | Переменная окружения       | Значение по умолчанию | Описание                                                     |
| --------------------- | -------------------------- | --------------------- | ------------------------------------------------------------ |
| `--host`              | `SERVER_HOST`              | `0.0.0.0`             | Хост, на котором нужно слушать входящие соединения           |
| `--port`              | `SERVER_PORT`              | `10080`               | Порт, на котором нужно слушать входящие соединения           |
| `--working-directory` | `SERVER_WORKING_DIRECTORY` |                       | Абсолютный путь к директории, в которой будут храниться файлы |
| `--server-domain`     | `SERVER_DOMAIN`            | `domain.example`      | Домен, на котором должен слушать сервер                      |

Если не передан параметр командной сроки, то значением параметра будет значение из окружения. Если же значение переменной окружения не указано, нужно использовать значение по умолчанию. 



Если не задан параметр `working-directory`, то нужно сделать `exit(1)`.

### Методы

#### GET {url}

Возвращает файл, находящийся по пути `{url}`, считая от `working-directory`.

Если путь является директорией, то нужно вывести пользователю таблицу всех
файлов внутри директории, представляющую информацию в следующем формате:
является ли путь директорией, владелец файла, группа файла, размер inode в
байтах, дата, время, название:

```
dr-xr-xr-x naorlov naorlov 100 2020-01-01 12:34:00 directory_name
-rwxr--r-- naorlov staff 100 2020-01-01 12:36:00 filename
```

Если клиент выразил желание получить данные в сжатом виде (передал
заголовок `Accept-Encoding`), то данные должны быть сжаты указанным способом
сжатия. Подробнее в секции `Заголовки`.

Если путь отсутствует либо не является валидным путем, необходимо вернуть код
ответа 404 и человеко-читаемый текст в теле ответа.

#### POST {url}

Создает новый файл на сервере по пути `{url}`, считая от `working-directory`.
Данные файла передаются в теле запроса. Если передан
заголовок `Create-Directory: True`, то необходимо создать по указанному пути
директорию.

Если файл уже существует, то необходимо вернуть код ответа 409 и
человеко-читаемый текст в теле ответа.

#### PUT {url}

Обновляет содержимое файла по пути `{url}`, считая от `working-directory`. Новые
данные файла передаются в теле запроса.

Если файл является директорией, то необходимо вернуть код ответа 409 и
человеко-читаемый текст в теле ответа.

#### DELETE {url}

Удаляет файл по пути `{url}`, считая от `working-directory`. Если путь является директорией и в заголовках не указан заголовок `Remove-Directories`, то нужно вернуть ответ 406. При успешном удалении вернуть 200.

### Заголовки

Обмен между клиентом и сервером должен поддерживать следующие заголовки:

| Заголовок          | Допустимые значения  | Обязательный? | Использование | Описание                                                     |
| ------------------ | -------------------- | ------------- | ------------- | ------------------------------------------------------------ |
| `Host`             | Любой валидный домен | Да            | Клиент        | Клиент должен отправлять заголовок `Host` с каждым запросом к серверу. В случае, если переданный заголовок не совпадает со значением параметра `server-domain`, необходимо вернуть код ответа 400. |
| `Content-Length`   | Число                | Да            | Сервер        | Число байт в ответе сервера                                  |
| `Content-Type`     | MIME-тип             | Да            | Сервер        | MIME-тип, обозначающий тип передаваемого контента            |
| `Content-Encoding` | `gzip`               | Нет           | Сервер        | Обозначает, что данные ответа сжаты указанным алгоритмом. Если не указан, то данные ответа не являются сжатыми. |
| `Accept-Encoding`  | `gzip`               | Нет           | Клиент        | Обозначает, что клиент готов принимать данные, сжатые указанным алгоритмом. Если не указан, данные сжимать не нужно. |
| `Create-Directory` | `True`, `False`      | Нет           | Клиент        | Если указан И запрос является `POST` запросом, то по указанному пути необходимо создать директорию. |
| `Server`           | Строка               |               | Сервер        | Название вашего сервера                                      |
| `Remove-Directory` | `True`,`False`       | Нет           | Клиент        | Указание заголовка позволяет системе удалить директорию полностью |

### Протокол

1. Является подмножеством протокола HTTP/1.1
2. После отправки ответа от сервера клиенту нужно закрыть соединение

## Компоненты задания

1. **(4 балла)** Сериализация и десериализация HTTP запроса и ответа
2. **(1.5 балла)** Обработчик метода GET
3. **(1.5 балла)** Обработчик метода POST
4. **(1.5 балла)** Обработчик метода PUT
5. **(1.5 балла)** Обработчик метода DELETE

При отсутствии README проверка производиться не будет. В нем нужно будет написать используемые библиотеки, если они отличаются от заготовки, а также общее описание архитектуры приложения.



## Выполнение задания

> *⚠️ Если вы пишете не на Python, то вам необходимо сделать следующее:*
>
> 1. Написать класс/объект/структуру/etc, хранящую в себе параметры HTTP запроса и
>     ответа. Структура такого объекта должна отражать структуру Python объекта в
>     заготовке на Python.
> 2. Написать тесты, отражающие Python-тесты на такую структуру.
> 3. Приступить к выполнению задания дальше

Код заготовки на питоне приведен в файле `server/server.py`. 

Запуск заготовки:

```bash
$ cd 3-http
$ docker-compose build server tests
$ docker-compose up -d server
$ docker-compose up tests
```

В конце тестирования будет напечатан отчет о тестировнии, включающий предварительную оценку. 

